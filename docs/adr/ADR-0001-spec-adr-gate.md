# ADR-0001 — Ввести обязательный Spec/ADR gate перед реализацией кода

[LEGEND]
ADR = P02
DECISION = Проверки перед стартом реализации через compas gate.
OWNER = AGENT
STATUS = Approved
[CONTENT]
## Goal
Обеспечить, чтобы реализация в repo начиналась только после наличия верифицируемых Spec/ADR материалов с секциями `Goal`, `Non-goals`, `Acceptance`, `Edge-cases`, `Rollback`.

## Non-goals
- Нельзя превращать этот ADR в единственный источник требований к продукту;
- ADR не заменяет технические ADR на уровне архитектуры домена;
- Не регламентирует структуру всех будущих документов, только путь и минимальный проверочный контракт для плагина P02.

## Acceptance
- В репозитории должен существовать плагин P02 с конфигом: `id = "p02"`, gates `ci_fast/ci/flagship` включают `spec-check`;
- В quality_contract должен быть `impact.rules`, который для `docs/spec/**` и `docs/adr/**` требует `spec-check`;
- Проверочный инструмент должен быть описан в `tool.toml` и исполняться через `python3`;
- Проверка должна быть fail-closed: невалидный/отсутствующий документ или секция ⇒ exit code != 0 и блокировка gate.

## Edge-cases
- Изменение только кода без обновления Spec/ADR не должно проходить проверки для изменений в `docs/spec/**`/`docs/adr/**`;
- Изменения в других path остаются под действием существующего пайплайна и не требуют `spec-check`;
- Любое нарушение синтаксиса markdown/кодов плагина трактуется как блокирующее валидационное правило.

## Rollback
- Для эскалации инцидента допускается временно исключить правило impact и gate шаг (или plugin) только через согласованный PR-эксепшен и с последующим восстановлением;
- После устранения причины включить P02 обратно и зафиксировать evidence повторного прохождения `cargo run -p ai-dx-mcp -- validate ratchet` и `./dx ci-fast --dry-run`.
